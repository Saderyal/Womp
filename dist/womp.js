const te=!1;let D=null,N=0;const _="$wc$",T="wc-wc",V=/<\/?$/g,P=/\s+([^\s]*?)="?$/g;//! Can cause problems. You should put also the "s" modifier
const I=/(<([a-z]*?-[a-z]*).*?)\/>/g,W=/<(?<tag>script|style|textarea|title])(?!.*?<\/\k<tag>)/gi,L=/^(?:script|style|textarea|title)$/i,w=0,v=1,R=2,S=typeof global<"u",A=S?{createTreeWalker(){}}:document,k=A.createTreeWalker(A,129);class F{constructor(e,n){this.template=e,this.dependencies=n}clone(){const e=this.template.content,n=this.dependencies,s=document.importNode(e,!0);k.currentNode=s;let t=k.nextNode(),a=0,i=0,r=n[0];const c=[];for(;r!==void 0;){if(a===r.index){let l;const d=r.type;d===w?l=new O(t,t.nextSibling):d===v?l=new j(t,r):d===R&&(l=new q(t)),c.push(l),r=n[++i]}a!==r?.index&&(t=k.nextNode(),a++)}return k.currentNode=document,[s,c]}}class z{constructor(e,n,s){this.stringifiedTemplate=e,this.values=n,this.template=s}}class O{constructor(e,n){this.isNode=!0;this.isAttr=!1;this.isTag=!1;this.startNode=e,this.endNode=n}clearValue(){let e=this.startNode.nextSibling;for(;e!==this.endNode;)e.remove(),e=this.startNode.nextSibling}dispose(){this.clearValue(),this.startNode.remove(),this.endNode.remove()}}class j{constructor(e,n){this.isNode=!1;this.isAttr=!0;this.isTag=!1;this.__eventInitialized=!1;this.node=e,this.name=n.name,this.attrStructure=n.attrDynamics}updateValue(e){if(this.name==="ref"&&e.__wcRef){if(e.current=this.node,this.node._$womp){const t=this.node.onDisconnected;this.node.onDisconnected=()=>{e.current=null,t()}}return}const n=this.node._$womp;n&&this.node.updateProps(this.name,e);const s=e!==Object(e);if(e===!1)this.node.removeAttribute(this.name);else if(s&&!this.name.match(/[A-Z]/))this.node.setAttribute(this.name,e);else if(this.name==="style"){let t="";const a=Object.keys(e);for(const i of a){let r=e[i],c=i.replace(/[A-Z]/g,l=>"-"+l.toLowerCase());typeof r=="number"&&(r=`${r}px`),t+=`${c}:${r};`}this.node.setAttribute(this.name,t)}this.name==="title"&&n&&this.node.removeAttribute(this.name)}set callback(e){if(!this.__eventInitialized){const n=this.name.substring(1);this.node.addEventListener(n,this.__listener.bind(this)),this.__eventInitialized=!0}this.__callback=e}__listener(e){this.__callback&&this.__callback(e)}}class q{constructor(e){this.isNode=!1;this.isAttr=!1;this.isTag=!0;this.node=e}}class G{constructor(e){this._$wompChildren=!0;this.nodes=e}}class U{constructor(e,n){this.isArrayDependency=!0;this.dynamics=[],this.__parentDependency=n,this.addDependenciesFrom(n.startNode,e.length),this.__oldValues=E(this.dynamics,e,[])}addDependenciesFrom(e,n){let s=e,t=n;for(;t;){const a=document.createComment("?START"),i=document.createComment("?END");s.after(a),a.after(i);const r=new O(a,i);s=i,this.dynamics.push(r),t--}}checkUpdates(e){let n=e.length-this.__oldValues.length;if(n>0){let s=this.dynamics[this.dynamics.length-1]?.endNode;s||(s=this.__parentDependency.startNode),this.addDependenciesFrom(s,n)}else if(n<0)for(;n;)this.dynamics.pop().dispose(),n++;return this.__oldValues=E(this.dynamics,e,this.__oldValues),this}}const B=(o,e)=>{const{css:n}=o,{shadow:s,name:t,cssGeneration:a}=e,i=t,r={};let c=n;if(a){if(n.includes(":host")||(c=`${s?":host":i} {display:block;} ${n}`),0){//! Some valid selectors are marked as invalid e.g. :host/componentName, @media, etc.
}s||(c=c.replace(/:host/g,i)),c=c.replace(/\.(?!\d)(.*?)[\s|{|,|+|~|>]/gm,(l,d)=>{const p=`${i}__${d}`;return r[d]=p,`.${p} `})}return[c,r]},K=o=>{let e="";const n=[],s=o.length-1;let t="",a="";for(let i=0;i<s;i++){let r=o[i];if(t&&r.includes(t)&&(t=""),a&&new RegExp(`</${a}>`)&&(a=""),t||a)e+=r+_;else{P.lastIndex=0;const c=P.exec(r);if(c){const[l,d]=c,p=l[l.length-1];t=p==='"'||p==="'"?p:"",r=r.substring(0,r.length-t.length-1);let m=`${r}${_}=`;t?m+=`${t}${_}`:m+='"0"',e+=m,n.push(d)}else{if(r.match(V)){e+=r+T;continue}W.lastIndex=0;const l=W.exec(r);l?(a=l[1],e+=r+_):e+=r+`<?${_}>`}}}return e+=o[o.length-1],e=e.replace(I,"$1></$2>"),[e,n]},Z=(o,e,n)=>{const s=[];k.currentNode=o.content;let t,a=0,i=0;const r=e.length;for(;(t=k.nextNode())!==null&&s.length<r;){if(t.nodeType===1){if(t.nodeName===T.toUpperCase()){const c={type:R,index:i};s.push(c)}if(t.hasAttributes()){const c=t.getAttributeNames();for(const l of c)if(l.endsWith(_)){const d=n[a++],p=t.getAttribute(l);if(p!=="0"){const m=p.split(_);for(let u=0;u<m.length-1;u++){const h={type:v,index:i,attrDynamics:p,name:d};s.push(h)}}else{const m={type:v,index:i,name:d};s.push(m)}t.removeAttribute(l)}}if(L.test(t.tagName)){const c=t.textContent.split(_),l=c.length-1;if(l>0){t.textContent="";for(let d=0;d<l;d++)t.append(c[d],document.createComment("")),k.nextNode(),s.push({type:w,index:++i});t.append(c[l],document.createComment(""))}}}else t.nodeType===8&&t.data===`?${_}`&&s.push({type:w,index:i});i++}return s},M=o=>{const[e,n]=K(o),s=document.createElement("template");s.innerHTML=e;const t=Z(s,o,n);return new F(s,t)},Y=o=>{let e="";const{parts:n,values:s}=o;for(let t=0;t<n.length;t++)e+=n[t],s[t]?.componentName&&(e+=s[t].componentName);return e},J=(o,e,n)=>{const s=o!==e,t=!!n.attrStructure,i=o?._$wompChildren&&n.startNode.nextSibling!==o.nodes[0];return s||t||i},E=(o,e,n)=>{const s=[...e];for(let t=0;t<o.length;t++){const a=o[t],i=s[t],r=n[t];if(J(i,r,a)){if(a.isNode){if(i===!1){a.clearValue();continue}if(i?._$wompHtml){const p=r?.stringifiedTemplate,m=Y(i);if(r===void 0||!(m===p)){const f=M(i.parts).clone(),[y,x]=f;s[t]=new z(m,i.values,f),E(x,i.values,r?.values??r??[]);const b=a.endNode,$=a.startNode;let g=$.nextSibling;for(;g!==b;)g.remove(),g=$.nextSibling;for(g=$;y.childNodes.length;)g.after(y.childNodes[0]),g=g.nextSibling}else{const[h,f]=r.template,y=E(f,i.values,r.values);r.values=y,s[t]=r}continue}const c=i!==Object(i),l=r!==Object(r)&&r!==void 0,d=a.startNode;if(c)l?d.nextSibling?d.nextSibling.textContent=i:d.after(i):(a.clearValue(),d.after(i));else{let p=d.nextSibling,m=0,u=0;if(i._$wompChildren){const h=i.nodes;for(;u<h.length;){(!p||u===0)&&(p=d);const f=h[m];m++,p.after(f),p=p.nextSibling,u++}}else Array.isArray(i)&&(r?.isArrayDependency?s[t]=r.checkUpdates(i):(a.clearValue(),s[t]=new U(i,a)))}}else if(a.isAttr)if(a.name.startsWith("@"))a.callback=i;else{const l=a.attrStructure;if(l){const d=l.split(_);let p=i;for(let m=0;m<d.length-1;m++)d[m]=`${d[m]}${p}`,t++,p=s[t];t--,a.updateValue(d.join("").trim())}else a.updateValue(i)}else if(a.isTag){const c=a.node;let l=null;const d=i._$wompF,p=d?i.componentName:i;if(c.nodeName!==p.toUpperCase()){const m=c.getAttributeNames();if(d){const f={};for(const x of m){const b=c.getAttribute(x);f[x]=b===""?!0:b}l=new i.class,l._$initialProps=f;const y=c.childNodes;for(;y.length;)l.appendChild(y[0])}else{l=document.createElement(p);for(const f of m)l.setAttribute(f,c.getAttribute(f))}let u=t,h=o[u];for(;h?.node===c;)h.node=l,h=o[++u],h?.name&&h?.name!=="ref"&&(l._$initialProps[h.name]=e[u]);c.replaceWith(l)}}}}return s},Q=(o,e)=>{const{generatedCSS:n,styles:s}=o.options;let t;const a=`${e.name}__styles`;return window.wompHydrationData?(t=document.createElement("link"),t.rel="stylesheet",t.href=`/${e.name}.css`):(t=document.createElement("style"),n&&(t.classList.add(a),t.textContent=n,e.shadow||document.body.appendChild(t))),class extends HTMLElement{constructor(){super();this._$womp=!0;this.props={};this._$hooks=[];this._$measurePerf=!1;this._$initialProps={};this._$usesContext=!1;this._$hasBeenMoved=!1;this.__updating=!1;this.__oldValues=[];this.__isInitializing=!0;this.__connected=!1;this.__isInDOM=!1}static{this._$womp=!0}static{this.componentName=e.name}static _$getOrCreateTemplate(c){return this._$cachedTemplate||(this._$cachedTemplate=M(c)),this._$cachedTemplate}connectedCallback(){this.__isInDOM=!0,!this.__connected&&this.isConnected&&this.initElement()}disconnectedCallback(){this.__connected&&(this.__isInDOM=!1,Promise.resolve().then(()=>{this.__isInDOM?(this._$hasBeenMoved=!0,this._$usesContext&&this.requestRender()):this.onDisconnected()}))}onDisconnected(){}initElement(){this.__ROOT=this;//! To finish
const c=this.getAttribute("womp-hydrate");//! when you implement hydration, immediately return: it's not necessary to initialize
c!==null&&window.wompHydrationData&&this.__hydrate(c),this.props={...this.props,...this._$initialProps,styles:s};const l=this.getAttributeNames();for(const C of l)if(!this.props.hasOwnProperty(C)){const H=this.getAttribute(C);this.props[C]=H===""?!0:H}const d=this.__ROOT.childNodes,p=[];for(;d.length;)p.push(d[0]),d[0].remove();const m=new G(p);this.props.children=m,e.shadow&&!this.shadowRoot&&(this.__ROOT=this.attachShadow({mode:"open"}));const u=t.cloneNode(!0);this.__ROOT.appendChild(u);const h=this.__callComponent(),{values:f,parts:y}=h,x=this.constructor._$getOrCreateTemplate(y),[b,$]=x.clone();this.__dynamics=$;const g=E(this.__dynamics,f,this.__oldValues);for(this.__oldValues=g;b.childNodes.length;)this.__ROOT.appendChild(b.childNodes[0]);this.__isInitializing=!1,this.__connected=!0}__hydrate(c){//! To finish
this.shadowRoot&&(this.__ROOT=this.shadowRoot);const l=window.wompHydrationData[e.name][c];this._$initialProps=structuredClone(l)}__callComponent(){D=this,N=0;const c=o.call(this,this.props);let l=c;return(typeof c=="string"||c instanceof HTMLElement)&&(l=html`${c}`),l}requestRender(){this.__updating||(this.__updating=!0,Promise.resolve().then(()=>{const c=this.__callComponent(),l=E(this.__dynamics,c.values,this.__oldValues);this.__oldValues=l,this.__updating=!1,this._$hasBeenMoved=!1}))}updateProps(c,l){this.props[c]!==l&&(this.props[c]=l,this.__isInitializing||(console.warn(`Updating ${c}`,this.__isInitializing),this.requestRender()))}}};export const useHook=()=>{const n=[D,N];return N++,n},useState=o=>{const[e,n]=useHook();if(!e)return[o,()=>{}];if(!e._$hooks.hasOwnProperty(n)){const t=n;e._$hooks[t]=[o,a=>{let i=a;const r=e._$hooks[t];typeof a=="function"&&(i=a(r[0])),i!==r[0]&&(r[0]=i,e.requestRender())}]}return e._$hooks[n]},useEffect=(o,e)=>{const[n,s]=useHook();if(n._$hooks.hasOwnProperty(s)){const t=n._$hooks[s];for(let a=0;a<e.length;a++)if(t.dependencies[a]!==e[a]){typeof t.cleanupFunction=="function"&&t.cleanupFunction(),Promise.resolve().then(()=>{t.cleanupFunction=o(),t.dependencies=e});break}}else{const t={dependencies:e,callback:o,cleanupFunction:null};n._$hooks[s]=t,Promise.resolve().then(()=>{t.cleanupFunction=o()})}},useLayoutEffect=(o,e)=>{const[n,s]=useHook();if(n._$hooks.hasOwnProperty(s)){const t=n._$hooks[s];for(let a=0;a<e.length;a++)if(t.dependencies[a]!==e[a]){typeof t.cleanupFunction=="function"&&t.cleanupFunction(),t.cleanupFunction=o(),t.dependencies=e;break}}else{const t={dependencies:e,callback:o,cleanupFunction:null};n._$hooks[s]=t,t.cleanupFunction=o()}},useRef=(o=null)=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]={current:o,__wcRef:!0}),e._$hooks[n]},useCallback=o=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]=o),e._$hooks[n]};const X=()=>{let o=0;return()=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]=`:r${o}:`,o++),e._$hooks[n]}};export const useId=X(),useMemo=(o,e)=>{const[n,s]=useHook();if(!n._$hooks.hasOwnProperty(s))n._$hooks[s]={value:o(),dependencies:e};else{const a=n._$hooks[s];for(let i=0;i<e.length;i++)if(a.dependencies[i]!==e[i]){a.dependencies=e,a.value=o();break}}return n._$hooks[s].value},useReducer=(o,e)=>{const[n,s]=useHook(),t=s;if(!n._$hooks.hasOwnProperty(t)){const r=[e,c=>{const l=n._$hooks[t][0],d=o(l,c),p=Object.keys(d);for(const u of p)if(d[u]!==l[u]){n.requestRender();break}const m={...l,...d};n._$hooks[s][0]=m}];n._$hooks[s]=r}return n._$hooks[s]},useExposed=o=>{const e=D,n=Object.keys(o);for(const s of n)e[s]=o[s]};const ee=()=>{let o=0;return e=>{const n=`womp-context-provider-${o}`;o++;const s=defineWomp(({children:a})=>{const r=useRef(new Set);return useExposed({subscribers:r}),r.current.forEach(c=>c.requestRender()),html`${a}`},{name:n,cssGeneration:!1});return{name:n,Provider:s,default:e,subscribers:new Set}}};export const createContext=ee(),useContext=o=>{const[e,n]=useHook();if(e._$usesContext=!0,!e._$hooks.hasOwnProperty(n)||e._$hasBeenMoved){let t=e;const a=o.name.toUpperCase();for(;t&&t.nodeName!==a&&t!==document.body;)t instanceof ShadowRoot?t=t.host:t=t.parentNode;const i=e._$hooks[n]?.node;if(t&&t!==document.body){t.subscribers.current.add(e);const r=e.onDisconnected;e.onDisconnected=()=>{t.subscribers.current.delete(e),r()}}else i&&i.subscribers.current.delete(e);e._$hooks[n]={node:t,value:t&&t!==document.body?t.props.value:o.default}}const s=e._$hooks[n].node;return s?s.props.value:o.default};export function html(o,...e){const n=[],s=o.length-1;if(S)n.push(...e);else for(let t=0;t<s;t++)o[t].endsWith("</")||n.push(e[t]);return{parts:o,values:n,_$wompHtml:!0}}export const wompDefaultOptions={shadow:!1,name:"",cssGeneration:!0},registeredComponents={};export function defineWomp(o,e){o.css||(o.css="");const n={...wompDefaultOptions,...e||{}};if(!n.name){let a=o.name.replace(/.[A-Z]/g,i=>`${i[0]}-${i[1].toLowerCase()}`).toLowerCase();a.includes("-")||(a+="-womp"),n.name=a}o.componentName=n.name,o._$wompF=!0;const[s,t]=B(o,n);if(o.css=s,o.options={generatedCSS:s,styles:t,shadow:n.shadow},!S){const a=Q(o,n);o.class=a,customElements.define(n.name,a)}return registeredComponents[n.name]=o,o}
