const te=!1;let D=null,N=0;const _="$wc$",T="wc-wc",V=/<\/?$/g,P=/\s+([^\s]*?)="?$/g;//! Can cause problems. You should put also the "s" modifier
const I=/(<([a-z]*?-[a-z]*).*?)\/>/g,W=/<(?<tag>script|style|textarea|title])(?!.*?<\/\k<tag>)/gi,L=/^(?:script|style|textarea|title)$/i,w=0,v=1,R=2,H=typeof global<"u",A=H?{createTreeWalker(){}}:document,k=A.createTreeWalker(A,129);class F{constructor(e,n){this.template=e,this.dependencies=n}clone(){const e=this.template.content,n=this.dependencies,o=document.importNode(e,!0);k.currentNode=o;let t=k.nextNode(),i=0,a=0,r=n[0];const c=[];for(;r!==void 0;){if(i===r.index){let l;const d=r.type;d===w?l=new O(t,t.nextSibling):d===v?l=new z(t,r):d===R&&(l=new q(t)),c.push(l),r=n[++a]}i!==r?.index&&(t=k.nextNode(),i++)}return k.currentNode=document,[o,c]}}class j{constructor(e,n,o){this.stringifiedTemplate=e,this.values=n,this.template=o}}class O{constructor(e,n){this.isNode=!0;this.isAttr=!1;this.isTag=!1;this.startNode=e,this.endNode=n}clearValue(){let e=this.startNode.nextSibling;for(;e!==this.endNode;)e.remove(),e=this.startNode.nextSibling}dispose(){this.clearValue(),this.startNode.remove(),this.endNode.remove()}}class z{constructor(e,n){this.isNode=!1;this.isAttr=!0;this.isTag=!1;this.__eventInitialized=!1;this.node=e,this.name=n.name,this.attrStructure=n.attrDynamics}updateValue(e){if(this.name==="ref"&&e.__wcRef){if(e.current=this.node,this.node._$womp){const t=this.node.onDisconnected;this.node.onDisconnected=()=>{e.current=null,t()}}return}const n=this.node._$womp;n&&this.node.updateProps(this.name,e);const o=e!==Object(e);if(e===!1)this.node.removeAttribute(this.name);else if(o&&!this.name.match(/[A-Z]/))this.node.setAttribute(this.name,e);else if(this.name==="style"){let t="";const i=Object.keys(e);for(const a of i){let r=e[a],c=a.replace(/[A-Z]/g,l=>"-"+l.toLowerCase());typeof r=="number"&&(r=`${r}px`),t+=`${c}:${r};`}this.node.setAttribute(this.name,t)}this.name==="title"&&n&&this.node.removeAttribute(this.name)}set callback(e){if(!this.__eventInitialized){const n=this.name.substring(1);this.node.addEventListener(n,this.__listener.bind(this)),this.__eventInitialized=!0}this.__callback=e}__listener(e){this.__callback&&this.__callback(e)}}class q{constructor(e){this.isNode=!1;this.isAttr=!1;this.isTag=!0;this.node=e}}class G{constructor(e){this._$wompChildren=!0;this.nodes=e}}class U{constructor(e,n){this.isArrayDependency=!0;this.dynamics=[],this.__parentDependency=n,this.addDependenciesFrom(n.startNode,e.length),this.__oldValues=$(this.dynamics,e,[])}addDependenciesFrom(e,n){let o=e,t=n;for(;t;){const i=document.createComment("?START"),a=document.createComment("?END");o.after(i),i.after(a);const r=new O(i,a);o=a,this.dynamics.push(r),t--}}checkUpdates(e){let n=e.length-this.__oldValues.length;if(n>0){let o=this.dynamics[this.dynamics.length-1]?.endNode;o||(o=this.__parentDependency.startNode),this.addDependenciesFrom(o,n)}else if(n<0)for(;n;)this.dynamics.pop().dispose(),n++;return this.__oldValues=$(this.dynamics,e,this.__oldValues),this}}const B=(s,e)=>{const{css:n}=s,{shadow:o,name:t,cssGeneration:i}=e,a=t,r={};let c=n;if(i){if(n.includes(":host")||(c=`${o?":host":a} {display:block;} ${n}`),0){//! Some valid selectors are marked as invalid e.g. :host/componentName, @media, etc.
}o||(c=c.replace(/:host/g,a)),c=c.replace(/\.(?!\d)(.*?)[\s|{|,|+|~|>]/gm,(l,d)=>{const p=`${a}__${d}`;return r[d]=p,`.${p} `})}return[c,r]},Z=s=>{let e="";const n=[],o=s.length-1;let t="",i="";for(let a=0;a<o;a++){let r=s[a];if(t&&r.includes(t)&&(t=""),i&&new RegExp(`</${i}>`)&&(i=""),t||i)e+=r+_;else{P.lastIndex=0;const c=P.exec(r);if(c){const[l,d]=c,p=l[l.length-1];t=p==='"'||p==="'"?p:"",r=r.substring(0,r.length-t.length-1);let m=`${r}${_}=`;t?m+=`${t}${_}`:m+='"0"',e+=m,n.push(d)}else{if(r.match(V)){e+=r+T;continue}W.lastIndex=0;const l=W.exec(r);l?(i=l[1],e+=r+_):e+=r+`<?${_}>`}}}return e+=s[s.length-1],e=e.replace(I,"$1></$2>"),[e,n]},K=(s,e,n)=>{const o=[];k.currentNode=s.content;let t,i=0,a=0;const r=e.length;for(;(t=k.nextNode())!==null&&o.length<r;){if(t.nodeType===1){if(t.nodeName===T.toUpperCase()){const c={type:R,index:a};o.push(c)}if(t.hasAttributes()){const c=t.getAttributeNames();for(const l of c)if(l.endsWith(_)){const d=n[i++],p=t.getAttribute(l);if(p!=="0"){const m=p.split(_);for(let u=0;u<m.length-1;u++){const h={type:v,index:a,attrDynamics:p,name:d};o.push(h)}}else{const m={type:v,index:a,name:d};o.push(m)}t.removeAttribute(l)}}if(L.test(t.tagName)){const c=t.textContent.split(_),l=c.length-1;if(l>0){t.textContent="";for(let d=0;d<l;d++)t.append(c[d],document.createComment("")),k.nextNode(),o.push({type:w,index:++a});t.append(c[l],document.createComment(""))}}}else t.nodeType===8&&t.data===`?${_}`&&o.push({type:w,index:a});a++}return o},M=s=>{const[e,n]=Z(s),o=document.createElement("template");o.innerHTML=e;const t=K(o,s,n);return new F(o,t)},Y=s=>{let e="";const{parts:n,values:o}=s;for(let t=0;t<n.length;t++)e+=n[t],o[t]?.componentName&&(e+=o[t].componentName);return e},J=(s,e,n)=>{const o=s!==e,t=!!n.attrStructure,a=s?._$wompChildren&&n.startNode.nextSibling!==s.nodes[0];return o||t||a},$=(s,e,n)=>{const o=[...e];for(let t=0;t<s.length;t++){const i=s[t],a=o[t],r=n[t];if(J(a,r,i)){if(i.isNode){if(a===!1){i.clearValue();continue}if(a?._$wompHtml){const p=r?.stringifiedTemplate,m=Y(a);if(r===void 0||!(m===p)){const f=M(a.parts).clone(),[y,x]=f;o[t]=new j(m,a.values,f),$(x,a.values,r?.values??r??[]);const b=i.endNode,E=i.startNode;let g=E.nextSibling;for(;g!==b;)g.remove(),g=E.nextSibling;for(g=E;y.childNodes.length;)g.after(y.childNodes[0]),g=g.nextSibling}else{const[h,f]=r.template,y=$(f,a.values,r.values);r.values=y,o[t]=r}continue}const c=a!==Object(a),l=r!==Object(r)&&r!==void 0,d=i.startNode;if(c)l?d.nextSibling?d.nextSibling.textContent=a:d.after(a):(i.clearValue(),d.after(a));else{let p=d.nextSibling,m=0,u=0;if(a._$wompChildren){const h=a.nodes;for(;u<h.length;){(!p||u===0)&&(p=d);const f=h[m];m++,p.after(f),p=p.nextSibling,u++}}else Array.isArray(a)&&(r?.isArrayDependency?o[t]=r.checkUpdates(a):(i.clearValue(),o[t]=new U(a,i)))}}else if(i.isAttr)if(i.name.startsWith("@"))i.callback=a;else{const l=i.attrStructure;if(l){const d=l.split(_);let p=a;for(let m=0;m<d.length-1;m++)d[m]=`${d[m]}${p}`,t++,p=o[t];t--,i.updateValue(d.join("").trim())}else i.updateValue(a)}else if(i.isTag){const c=i.node;let l=null;const d=a._$wompF,p=d?a.componentName:a;if(c.nodeName!==p.toUpperCase()){const m=c.getAttributeNames();if(d){const f={};for(const x of m){const b=c.getAttribute(x);f[x]=b===""?!0:b}l=new a.class,l._$initialProps=f;const y=c.childNodes;for(;y.length;)l.appendChild(y[0])}else{l=document.createElement(p);for(const f of m)l.setAttribute(f,c.getAttribute(f))}let u=t,h=s[u];for(;h?.node===c;)h.node=l,h=s[++u],h?.name&&h?.name!=="ref"&&(l._$initialProps[h.name]=e[u]);c.replaceWith(l)}}}}return o},Q=(s,e)=>{const{generatedCSS:n,styles:o}=s.options;let t;const i=`${e.name}__styles`;return window.wompHydrationData?(t=document.createElement("link"),t.rel="stylesheet",t.href=`/${e.name}.css`):(t=document.createElement("style"),n&&(t.classList.add(i),t.textContent=n,e.shadow||document.body.appendChild(t))),class extends HTMLElement{constructor(){super();this._$womp=!0;this.props={};this._$hooks=[];this._$measurePerf=!1;this._$initialProps={};this._$usesContext=!1;this._$hasBeenMoved=!1;this.__updating=!1;this.__oldValues=[];this.__isInitializing=!0;this.__connected=!1;this.__isInDOM=!1}static{this._$womp=!0}static{this.componentName=e.name}static _$getOrCreateTemplate(c){return this._$cachedTemplate||(this._$cachedTemplate=M(c)),this._$cachedTemplate}connectedCallback(){this.__isInDOM=!0,!this.__connected&&this.isConnected&&this.initElement()}disconnectedCallback(){this.__connected&&(this.__isInDOM=!1,Promise.resolve().then(()=>{this.__isInDOM?(this._$hasBeenMoved=!0,this._$usesContext&&this.requestRender()):this.onDisconnected()}))}onDisconnected(){}initElement(){this.__ROOT=this;//! To finish
const c=this.getAttribute("womp-hydrate");//! when you implement hydration, immediately return: it's not necessary to initialize
c!==null&&window.wompHydrationData&&this.__hydrate(c),this.props={...this.props,...this._$initialProps,styles:o};const l=this.getAttributeNames();for(const C of l)if(!this.props.hasOwnProperty(C)){const S=this.getAttribute(C);this.props[C]=S===""?!0:S}const d=this.__ROOT.childNodes,p=[];for(;d.length;)p.push(d[0]),d[0].remove();const m=new G(p);this.props.children=m,e.shadow&&!this.shadowRoot&&(this.__ROOT=this.attachShadow({mode:"open"}));const u=t.cloneNode(!0);this.__ROOT.appendChild(u);const h=this.__callComponent(),{values:f,parts:y}=h,x=this.constructor._$getOrCreateTemplate(y),[b,E]=x.clone();this.__dynamics=E;const g=$(this.__dynamics,f,this.__oldValues);for(this.__oldValues=g;b.childNodes.length;)this.__ROOT.appendChild(b.childNodes[0]);this.__isInitializing=!1,this.__connected=!0}__hydrate(c){//! To finish
this.shadowRoot&&(this.__ROOT=this.shadowRoot);const l=window.wompHydrationData[e.name][c];this._$initialProps=structuredClone(l)}__callComponent(){D=this,N=0;const c=s.call(this,this.props);let l=c;return(typeof c=="string"||c instanceof HTMLElement)&&(l=html`${c}`),l}requestRender(){this.__updating||(this.__updating=!0,Promise.resolve().then(()=>{const c=this.__callComponent(),l=$(this.__dynamics,c.values,this.__oldValues);this.__oldValues=l,this.__updating=!1,this._$hasBeenMoved=!1}))}updateProps(c,l){this.props[c]!==l&&(this.props[c]=l,this.__isInitializing||(console.warn(`Updating ${c}`,this.__isInitializing),this.requestRender()))}}};export const useHook=()=>{const n=[D,N];return N++,n},useState=s=>{const[e,n]=useHook();if(!e)return[s,()=>{}];if(!e._$hooks.hasOwnProperty(n)){const t=n;e._$hooks[t]=[s,i=>{let a=i;const r=e._$hooks[t];typeof i=="function"&&(a=i(r[0])),a!==r[0]&&(r[0]=a,e.requestRender())}]}return e._$hooks[n]},useEffect=(s,e)=>{const[n,o]=useHook();if(n._$hooks.hasOwnProperty(o)){const t=n._$hooks[o];for(let i=0;i<e.length;i++)if(t.dependencies[i]!==e[i]){typeof t.cleanupFunction=="function"&&t.cleanupFunction(),Promise.resolve().then(()=>{t.cleanupFunction=s(),t.dependencies=e});break}}else{const t={dependencies:e,callback:s,cleanupFunction:null};n._$hooks[o]=t,Promise.resolve().then(()=>{t.cleanupFunction=s()})}},useLayoutEffect=(s,e)=>{const[n,o]=useHook();if(n._$hooks.hasOwnProperty(o)){const t=n._$hooks[o];for(let i=0;i<e.length;i++)if(t.dependencies[i]!==e[i]){typeof t.cleanupFunction=="function"&&t.cleanupFunction(),t.cleanupFunction=s(),t.dependencies=e;break}}else{const t={dependencies:e,callback:s,cleanupFunction:null};n._$hooks[o]=t,t.cleanupFunction=s()}},useRef=(s=null)=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]={current:s,__wcRef:!0}),e._$hooks[n]},useCallback=s=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]=s),e._$hooks[n]};const X=()=>{let s=0;return()=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]=`:r${s}:`,s++),e._$hooks[n]}};export const useId=X(),useMemo=(s,e)=>{const[n,o]=useHook();if(!n._$hooks.hasOwnProperty(o))n._$hooks[o]={value:s(),dependencies:e};else{const i=n._$hooks[o];for(let a=0;a<e.length;a++)if(i.dependencies[a]!==e[a]){i.dependencies=e,i.value=s();break}}return n._$hooks[o].value},useReducer=(s,e)=>{const[n,o]=useHook(),t=o;if(!n._$hooks.hasOwnProperty(t)){const r=[e,c=>{const l=n._$hooks[t][0],d=s(l,c),p=Object.keys(d);for(const u of p)if(d[u]!==l[u]){n.requestRender();break}const m={...l,...d};n._$hooks[o][0]=m}];n._$hooks[o]=r}return n._$hooks[o]},useExposed=s=>{const e=D,n=Object.keys(s);for(const o of n)e[o]=s[o]};const ee=()=>{let s=0;return e=>{const n=`womp-context-provider-${s}`;s++;const o=defineWomp(({children:i})=>{const r=useRef(new Set);return useExposed({subscribers:r}),r.current.forEach(c=>c.requestRender()),html`${i}`},{name:n,cssGeneration:!1});return{name:n,Provider:o,default:e,subscribers:new Set}}};export const createContext=ee(),useContext=s=>{const[e,n]=useHook();if(e._$usesContext=!0,!e._$hooks.hasOwnProperty(n)||e._$hasBeenMoved){let t=e;const i=s.name.toUpperCase();for(;t&&t.nodeName!==i&&t!==document.body;)t instanceof ShadowRoot?t=t.host:t=t.parentNode;const a=e._$hooks[n]?.node;if(t&&t!==document.body){t.subscribers.current.add(e);const r=e.onDisconnected;e.onDisconnected=()=>{t.subscribers.current.delete(e),r()}}else a&&a.subscribers.current.delete(e);e._$hooks[n]={node:t,value:t&&t!==document.body?t.props.value:s.default}}const o=e._$hooks[n].node;return o?o.props.value:s.default};export function html(s,...e){const n=[],o=s.length-1;if(H)n.push(...e);else for(let t=0;t<o;t++)s[t].endsWith("</")||n.push(e[t]);return{parts:s,values:n,_$wompHtml:!0}}export const wompDefaultOptions={shadow:!1,name:"",cssGeneration:!0},registeredComponents={};export function defineWomp(s,e){s.css||(s.css="");const n={...wompDefaultOptions,...e||{}};if(!n.name){let i=s.name.replace(/.[A-Z]/g,a=>`${a[0]}-${a[1].toLowerCase()}`).toLowerCase();i.includes("-")||(i+="-womp"),n.name=i}s.componentName=n.name,s._$wompF=!0;const[o,t]=B(s,n);if(s.css=o,s.options={generatedCSS:o,styles:t,shadow:n.shadow},!H){const i=Q(s,n);s.class=i,customElements.define(n.name,i)}return registeredComponents[n.name]=s,s}export const jsx=(s,e)=>{const n={parts:[],values:[],_$wompHtml:!0};let o=s;s._$wompF?o=s.componentName:s===Fragment&&(o="");let t=o?`<${o}`:"";const i=Object.keys(e);for(const r of i){if(r==="children")break;const c=r.match(/on([A-Z].*)/);c?t+=` @${c[1].toLowerCase()}=`:t+=` ${r}=`,n.parts.push(t),n.values.push(e[r]),t=""}t+=o?">":"",n.parts.push(t);const a=e.children;if(a&&a.parts){if(e.children.parts)n.values.push(!1),n.parts.push(...e.children.parts),n.values.push(...e.children.values),n.values.push(!1);else if(Array.isArray(e.children))for(const r of e.children)n.values.push(!1),n.parts.push(...r.parts),n.values.push(...r.values),n.values.push(!1)}else n.values.push(a);return t=o?`</${o}>`:"",n.parts.push(t),n},Fragment="wc-fragment";
