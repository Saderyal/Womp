const ne=!1;let C=null,$=0;const h="$wc$",D="wc-wc",L=/<\/?$/g,w=/\s+([^\s]*?)="?$/g;//! Can cause problems. You should put also the "s" modifier
const F=/(<([a-z]*?-[a-z]*).*?)\/>/g,H=/<(?<tag>script|style|textarea|title])(?!.*?<\/\k<tag>)/gi,z=/^(?:script|style|textarea|title)$/i,E=0,S=1,v=2,N=typeof global<"u",T=N?{createTreeWalker(){}}:document,g=T.createTreeWalker(T,129);class q{constructor(e,n,o){this.template=e,this.dependencies=n,this.stringified=o}clone(){const e=this.template.content,n=this.dependencies,o=document.importNode(e,!0);g.currentNode=o;let t=g.nextNode(),a=0,i=0,r=n[0];const l=[];for(;r!==void 0;){if(a===r.index){let d;const c=r.type;c===E?d=new P(t,t.nextSibling):c===S?d=new U(t,r):c===v&&(d=new G(t)),l.push(d),r=n[++i]}a!==r?.index&&(t=g.nextNode(),a++)}return g.currentNode=document,[o,l]}}class j{constructor(e,n,o){this.stringifiedTemplate=e,this.values=n,this.template=o}}class P{constructor(e,n){this.isNode=!0;this.isAttr=!1;this.isTag=!1;this.startNode=e,this.endNode=n}clearValue(){let e=this.startNode.nextSibling;for(;e!==this.endNode;)e.remove(),e=this.startNode.nextSibling}dispose(){this.clearValue(),this.startNode.remove(),this.endNode.remove()}}class U{constructor(e,n){this.isNode=!1;this.isAttr=!0;this.isTag=!1;this.__eventInitialized=!1;this.node=e,this.name=n.name,this.attrStructure=n.attrDynamics}updateValue(e){if(this.name==="ref"&&e.__wcRef){if(e.current=this.node,this.node._$womp){const t=this.node.onDisconnected;this.node.onDisconnected=()=>{e.current=null,t()}}return}const n=this.node._$womp;n&&this.node.updateProps(this.name,e);const o=e!==Object(e);if(e===!1)this.node.removeAttribute(this.name);else if(o&&!this.name.match(/[A-Z]/))this.node.setAttribute(this.name,e);else if(this.name==="style"){let t="";const a=Object.keys(e);for(const i of a){let r=e[i],l=i.replace(/[A-Z]/g,d=>"-"+d.toLowerCase());typeof r=="number"&&(r=`${r}px`),t+=`${l}:${r};`}this.node.setAttribute(this.name,t)}this.name==="title"&&n&&this.node.removeAttribute(this.name)}set callback(e){if(!this.__eventInitialized){const n=this.name.substring(1);this.node.addEventListener(n,this.__listener.bind(this)),this.__eventInitialized=!0}this.__callback=e}__listener(e){this.__callback&&this.__callback(e)}}class G{constructor(e){this.isNode=!1;this.isAttr=!1;this.isTag=!0;this.node=e}}class B{constructor(e){this._$wompChildren=!0;this.nodes=e}}class Z{constructor(e,n){this.isArrayDependency=!0;this.dynamics=[],this.__parentDependency=n,this.addDependenciesFrom(n.startNode,e.length),this.__oldValues=b(this.dynamics,e,[])}addDependenciesFrom(e,n){let o=e,t=n;for(;t;){const a=document.createComment("?START"),i=document.createComment("?END");o.after(a),a.after(i);const r=new P(a,i);o=i,this.dynamics.push(r),t--}}checkUpdates(e){let n=e.length-this.__oldValues.length;if(n>0){let o=this.dynamics[this.dynamics.length-1]?.endNode;o||(o=this.__parentDependency.startNode),this.addDependenciesFrom(o,n)}else if(n<0)for(;n;)this.dynamics.pop().dispose(),n++;return this.__oldValues=b(this.dynamics,e,this.__oldValues),this}}const K=(s,e)=>{const{css:n}=s,{shadow:o,name:t,cssGeneration:a}=e,i=t,r={};let l=n;if(a){if(n.includes(":host")||(l=`${o?":host":i} {display:block;} ${n}`),0){//! Some valid selectors are marked as invalid e.g. :host/componentName, @media, etc.
}o||(l=l.replace(/:host/g,i)),l=l.replace(/\.(?!\d)([_a-zA-Z0-9-]+)/gm,(d,c)=>{const p=`${i}__${c}`;return r[c]=p,`.${p}`})}return[l,r]},Y=s=>{let e="";const n=[],o=s.length-1;let t="",a="";for(let i=0;i<o;i++){let r=s[i];if(t&&r.includes(t)&&(t=""),a&&new RegExp(`</${a}>`)&&(a=""),t||a)e+=r+h;else{w.lastIndex=0;const l=w.exec(r);if(l){const[d,c]=l,p=d[d.length-1];t=p==='"'||p==="'"?p:"",r=r.substring(0,r.length-t.length-1);let m=`${r}${h}=`;t?m+=`${t}${h}`:m+='"0"',e+=m,n.push(c)}else{if(r.match(L)){e+=r+D;continue}H.lastIndex=0;const d=H.exec(r);d?(a=d[1],e+=r+h):e+=r+`<?${h}>`}}}return e+=s[s.length-1],e=e.replace(F,"$1></$2>"),[e,n]},J=(s,e,n)=>{const o=[];g.currentNode=s.content;let t,a=0,i=0;const r=e.length;for(;(t=g.nextNode())!==null&&o.length<r;){if(t.nodeType===1){if(t.nodeName===D.toUpperCase()){const l={type:v,index:i};o.push(l)}if(t.hasAttributes()){const l=t.getAttributeNames();for(const d of l)if(d.endsWith(h)){const c=n[a++],p=t.getAttribute(d);if(p!=="0"){const m=p.split(h);for(let u=0;u<m.length-1;u++){const f={type:S,index:i,attrDynamics:p,name:c};o.push(f)}}else{const m={type:S,index:i,name:c};o.push(m)}t.removeAttribute(d)}}if(z.test(t.tagName)){const l=t.textContent.split(h),d=l.length-1;if(d>0){t.textContent="";for(let c=0;c<d;c++)t.append(l[c],document.createComment("")),g.nextNode(),o.push({type:E,index:++i});t.append(l[d],document.createComment(""))}}}else t.nodeType===8&&t.data===`?${h}`&&o.push({type:E,index:i});i++}return o},W=s=>{const[e,n]=Y(s.parts),o=document.createElement("template");o.innerHTML=e;const t=J(o,s.parts,n);return new q(o,t,R(s))},R=s=>{let e="";const{parts:n,values:o}=s;for(let t=0;t<n.length;t++)e+=n[t],o[t]?.componentName&&(e+=o[t].componentName);return e},Q=(s,e,n)=>{const o=s!==e,t=!!n.attrStructure,i=s?._$wompChildren&&n.startNode.nextSibling!==s.nodes[0];return o||t||i},A=(s,e,n,o,t)=>{const a=e.node;let i=null;const r=s._$wompF,l=r?s.componentName:s;if(a.nodeName!==l.toUpperCase()){const d=a.getAttributeNames();if(r){const m={};for(const f of d){const _=a.getAttribute(f);m[f]=_===""?!0:_}i=new s.class,i._$initialProps=m;const u=a.childNodes;for(;u.length;)i.appendChild(u[0])}else{i=document.createElement(l);for(const m of d)i.setAttribute(m,a.getAttribute(m))}let c=n,p=o[c];for(;p?.node===a;)p.node=i,p=o[++c],p?.name&&p?.name!=="ref"&&(i._$initialProps[p.name]=t[c]);return a.replaceWith(i),i}},b=(s,e,n)=>{const o=[...e];for(let t=0;t<s.length;t++){const a=s[t],i=o[t],r=n[t];if(Q(i,r,a)){if(a.isNode){if(i===!1||i===void 0||i===null){a.clearValue();continue}if(i?._$wompHtml){const p=r?.stringifiedTemplate,m=R(i);if(r===void 0||!(m===p)){const _=W(i).clone(),[k,I]=_;o[t]=new j(m,i.values,_),b(I,i.values,r?.values??r??[]);const V=a.endNode,x=a.startNode;let y=x.nextSibling;for(;y!==V;)y.remove(),y=x.nextSibling;for(y=x;k.childNodes.length;)y.after(k.childNodes[0]),y=y.nextSibling}else{const[f,_]=r.template,k=b(_,i.values,r.values);r.values=k,o[t]=r}continue}const l=i!==Object(i),d=r!==Object(r)&&r!==void 0,c=a.startNode;if(l)d?c.nextSibling?c.nextSibling.textContent=i:c.after(i):(a.clearValue(),c.after(i));else{let p=c.nextSibling,m=0,u=0;if(i._$wompChildren){const f=i.nodes;for(;u<f.length;){(!p||u===0)&&(p=c);const _=f[m];m++,p.after(_),p=p.nextSibling,u++}}else Array.isArray(i)&&(r?.isArrayDependency?o[t]=r.checkUpdates(i):(a.clearValue(),o[t]=new Z(i,a)))}}else if(a.isAttr)if(a.name.startsWith("@"))a.callback=i;else{const d=a.attrStructure;if(d){const c=d.split(h);let p=i;for(let m=0;m<c.length-1;m++)c[m]=`${c[m]}${p}`,t++,p=o[t];t--,a.updateValue(c.join("").trim())}else a.updateValue(i)}else if(a.isTag)if(i._$wompLazy){const d=a.node,c=O(d);c&&(c.addSuspense?c.addSuspense(d):(c.loadingComponents=new Set,c.loadingComponents.add(d)),d.suspense=c),i().then(p=>{const m=A(p,a,t,s,e);c&&c.removeSuspense(d,m)});continue}else A(i,a,t,s,e)}}return o},X=(s,e)=>{const{generatedCSS:n,styles:o}=s.options;let t;const a=`${e.name}__styles`;return window.wompHydrationData?(t=document.createElement("link"),t.rel="stylesheet",t.href=`/${e.name}.css`):(t=document.createElement("style"),n&&(t.classList.add(a),t.textContent=n,e.shadow||document.body.appendChild(t))),class extends HTMLElement{constructor(){super();this._$womp=!0;this.props={};this._$hooks=[];this._$measurePerf=!1;this._$initialProps={};this._$usesContext=!1;this._$hasBeenMoved=!1;this._$layoutEffects=[];this.__updating=!1;this.__oldValues=[];this.__isInitializing=!0;this.__connected=!1;this.__isInDOM=!1}static{this._$womp=!0}static{this.componentName=e.name}static _$getOrCreateTemplate(l){return this._$cachedTemplate||(this._$cachedTemplate=W(l)),this._$cachedTemplate}connectedCallback(){this.__isInDOM=!0,!this.__connected&&this.isConnected&&this.initElement()}disconnectedCallback(){this.__connected&&(this.__isInDOM=!1,Promise.resolve().then(()=>{if(this.__isInDOM)this._$hasBeenMoved=!0,this._$usesContext&&this.requestRender();else{this.onDisconnected();//! For each hook, if the hook is !null && has a cleanupFunction, execute it.
//! This beacuse timers will continue it's execution also after the component has been
//! Disconnected
}}))}onDisconnected(){}initElement(){this.__ROOT=this,this.props={...this.props,...this._$initialProps,styles:o};const l=this.getAttributeNames();for(const m of l)if(!this.props.hasOwnProperty(m)){const u=this.getAttribute(m);this.props[m]=u===""?!0:u}const d=this.__ROOT.childNodes,c=[];for(;d.length;)c.push(d[0]),d[0].remove();const p=new B(c);if(this.props.children=p,e.shadow&&!this.shadowRoot&&(this.__ROOT=this.attachShadow({mode:"open"})),n){const m=t.cloneNode(!0);this.__ROOT.appendChild(m)}this.__render(),this.__isInitializing=!1,this.__connected=!0}__callComponent(){C=this,$=0;const l=s.call(this,this.props);let d=l;return(typeof l=="string"||l instanceof HTMLElement)&&(d=html`${l}`),d}__render(){const l=this.__callComponent();if(l==null){this.remove();return}const d=this.constructor;if(this.__isInitializing){const c=d._$getOrCreateTemplate(l),[p,m]=c.clone();this.__dynamics=m;const u=b(this.__dynamics,l.values,this.__oldValues);for(this.__oldValues=u,this.__isInitializing||(this.__ROOT.innerHTML="");p.childNodes.length;)this.__ROOT.appendChild(p.childNodes[0])}else{const c=b(this.__dynamics,l.values,this.__oldValues);this.__oldValues=c}for(;this._$layoutEffects.length;){const c=this._$layoutEffects.pop();c.cleanupFunction=c.callback()}}requestRender(){this.__updating||(this.__updating=!0,Promise.resolve().then(()=>{this.__render(),this.__updating=!1,this._$hasBeenMoved=!1}))}updateProps(l,d){this.props[l]!==d&&(this.props[l]=d,this.__isInitializing||this.requestRender())}}};export const useHook=()=>{const n=[C,$];return $++,n},useState=s=>{const[e,n]=useHook();if(!e)return[s,()=>{}];if(!e._$hooks.hasOwnProperty(n)){const t=n;e._$hooks[t]=[s,a=>{let i=a;const r=e._$hooks[t];typeof a=="function"&&(i=a(r[0])),i!==r[0]&&(r[0]=i,e.requestRender())}]}return e._$hooks[n]},useEffect=(s,e=null)=>{const[n,o]=useHook();if(n._$hooks.hasOwnProperty(o)){const t=n._$hooks[o];if(e!==null){for(let a=0;a<e.length;a++)if(t.dependencies[a]!==e[a]){typeof t.cleanupFunction=="function"&&t.cleanupFunction(),Promise.resolve().then(()=>{t.cleanupFunction=s(),t.dependencies=e});break}}else Promise.resolve().then(()=>{t.cleanupFunction=s(),t.dependencies=e})}else{const t={dependencies:e,callback:s,cleanupFunction:null};n._$hooks[o]=t,Promise.resolve().then(()=>{t.cleanupFunction=s()})}},useLayoutEffect=(s,e=null)=>{const[n,o]=useHook();if(n._$hooks.hasOwnProperty(o)){const t=n._$hooks[o];if(e!==null){for(let a=0;a<e.length;a++)if(t.dependencies[a]!==e[a]){typeof t.cleanupFunction=="function"&&t.cleanupFunction(),n._$layoutEffects.push(t),t.dependencies=e;break}}else n._$layoutEffects.push(t)}else{const t={dependencies:e,callback:s,cleanupFunction:null};n._$hooks[o]=t,n._$layoutEffects.push(t)}},useRef=(s=null)=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]={current:s,__wcRef:!0}),e._$hooks[n]},useCallback=s=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]=s),e._$hooks[n]};const ee=()=>{let s=0;return()=>{const[e,n]=useHook();return e._$hooks.hasOwnProperty(n)||(e._$hooks[n]=`:r${s}:`,s++),e._$hooks[n]}};export const useId=ee(),useMemo=(s,e)=>{const[n,o]=useHook();if(!n._$hooks.hasOwnProperty(o))n._$hooks[o]={value:s(),dependencies:e};else{const a=n._$hooks[o];for(let i=0;i<e.length;i++)if(a.dependencies[i]!==e[i]){a.dependencies=e,a.value=s();break}}return n._$hooks[o].value},useReducer=(s,e)=>{const[n,o]=useHook(),t=o;if(!n._$hooks.hasOwnProperty(t)){const r=[e,l=>{const d=n._$hooks[t][0],c=s(d,l),p=Object.keys(c);for(const u of p)if(c[u]!==d[u]){n.requestRender();break}const m={...d,...c};n._$hooks[o][0]=m}];n._$hooks[o]=r}return n._$hooks[o]},useExposed=s=>{const e=C,n=Object.keys(s);for(const o of n)e[o]=s[o]};const M=(s,e,n)=>{const[o,t]=s;e&&e.addSuspense(o),o._$hooks[t].value=null,n().then(i=>{o.requestRender(),e.removeSuspense(o),o._$hooks[t].value=i}).catch(i=>console.error(i))};export const useAsync=(s,e)=>{const[n,o]=useHook(),t=O(n);if(!n._$hooks.hasOwnProperty(o))n._$hooks[o]={dependencies:e,value:null},M([n,o],t,s);else{const a=n._$hooks[o];let i=!1;for(let r=0;r<e.length;r++)if(a.dependencies[r]!==e[r]){a.dependencies=e,i=!0;break}i&&M([n,o],t,s)}return n._$hooks[o].value};const te=()=>{let s=0;return e=>{const n=`womp-context-provider-${s}`;s++;const o=defineWomp(({children:a})=>{const r=useRef(new Set);return useExposed({subscribers:r}),r.current.forEach(l=>l.requestRender()),html`${a}`},{name:n,cssGeneration:!1});return{name:n,Provider:o,default:e,subscribers:new Set}}};export const createContext=te(),useContext=s=>{const[e,n]=useHook();if(e._$usesContext=!0,!e._$hooks.hasOwnProperty(n)||e._$hasBeenMoved){let t=e;const a=s.name.toUpperCase();for(;t&&t.nodeName!==a&&t!==document.body;)t instanceof ShadowRoot?t=t.host:t=t.parentNode;const i=e._$hooks[n]?.node;if(t&&t!==document.body){t.subscribers.current.add(e);const r=e.onDisconnected;e.onDisconnected=()=>{t.subscribers.current.delete(e),r()}}else i&&i.subscribers.current.delete(e);e._$hooks[n]={node:t}}const o=e._$hooks[n].node;return o?o.props.value:s.default};export function html(s,...e){const n=[],o=s.length-1;if(N)n.push(...e);else for(let t=0;t<o;t++)s[t].endsWith("</")||n.push(e[t]);return{parts:s,values:n,_$wompHtml:!0}}export const wompDefaultOptions={shadow:!1,name:"",cssGeneration:!0},registeredComponents={};export function defineWomp(s,e){s.css||(s.css="");const n={...wompDefaultOptions,...e||{}};if(!n.name){let a=s.name.replace(/.[A-Z]/g,i=>`${i[0]}-${i[1].toLowerCase()}`).toLowerCase();a.includes("-")||(a+="-womp"),n.name=a}s.componentName=n.name,s._$wompF=!0;const[o,t]=K(s,n);if(s.css=o,s.options={generatedCSS:o,styles:t,shadow:n.shadow},!N){const a=X(s,n);s.class=a,customElements.define(n.name,a)}return registeredComponents[n.name]=s,s}export const lazy=s=>{let e=null;async function n(){return e||(e=(await s()).default,e)}return n._$wompLazy=!0,n};const O=s=>{let e=s;for(;e&&e.nodeName!==Suspense.componentName.toUpperCase();)e.parentNode===null&&e.host?e=e.host:e=e?.parentNode;return e};export function Suspense({children:s,fallback:e}){return this.loadingComponents||(this.loadingComponents=useRef(new Set).current),this.addSuspense=n=>{this.loadingComponents.size||this.requestRender(),this.loadingComponents.add(n)},this.removeSuspense=(n,o=null)=>{if(this.loadingComponents.delete(n),o){for(let t=0;t<s.nodes.length;t++)if(s.nodes[t]===n){s.nodes[t]=o;break}}this.loadingComponents.size||this.requestRender()},this.loadingComponents.size?html`${e}`:html`${s}`}defineWomp(Suspense,{name:"womp-suspense"});//! Test events on custom components
//! Test inputs (value attribute, specifically)
//! in DEV_MODE, handle errors nicely, in PRODUCTION, only console.error
